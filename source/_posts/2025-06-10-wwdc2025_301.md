---
title: 深入了解 Foundation Models 框架
date: 2025-06-10 15:44:51
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- macos
- 机器学习与-ai
---
使用 foundation models 框架提升性能。深入了解引导式生成的工作方式，并使用指南、正则表达式和生成方案来获取自定的结构化响应。我们将向你展示如何使用工具调用让模型自动访问外部信息并执行操作，从而实现个性化体验。

为了充分从这个视频中获益，建议你先观看“了解 foundation models 框架”。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9967/9967_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/301/)

# 掌握 Foundation Models 框架：从文本生成到工具调用

## 引言

Foundation Models 框架为开发者提供了在 Apple 生态系统中集成大型语言模型(LLM)的强大工具。通过设备端运行和简洁的 Swift API，该框架支持 macOS、iPadOS、iOS 和 visionOS 平台，无需复杂配置即可直接使用。本文将深入解析框架的核心功能，包括会话机制、结构化输出生成以及工具调用等关键技术。

## 会话机制详解

会话是 Foundation Models 框架的基础交互方式，特别适合构建对话式应用场景：

```swift
import FoundationModels

func respond(userInput: String) async throws -> String {
  let session = LanguageModelSession(instructions: """
    你是一个像素世界里的友善咖啡师。
    请回答玩家的问题。
    """
  )
  let response = try await session.respond(to: userInput)
  return response.content
}
```

### 关键技术解析
1. **Token处理机制**：模型将输入转换为token序列处理，每个token都会增加处理延迟
2. **状态保持**：会话自动记录所有交互历史，但需注意上下文窗口限制
3. **采样控制**：提供多种响应生成模式，从确定性输出到高创造性输出

## 结构化数据生成：Generable 技术

Generable 宏解决了从LLM获取结构化数据的难题：

```swift
@Generable
struct NPC {
  let name: String
  let coffeeOrder: String
}

func makeNPC() async throws -> NPC {
  let session = LanguageModelSession(instructions: ...)
  let response = try await session.respond(generating: NPC.self) {
    "生成一个点咖啡的角色。"
  }
  return response.content
}
```

### 高级功能
- **枚举支持**：处理复杂场景分支
- **Guide约束**：精确控制输出范围、格式和质量
- **正则表达式**：确保字符串字段符合特定模式

## 动态模式：运行时定义的Schema

对于需要动态结构的场景，可以使用GenerationSchema：

```swift
let schema = try GenerationSchema(
  root: riddleDynamicSchema,
  dependencies: [answerDynamicSchema]
)

let response = try await session.respond(
  to: "生成一个关于咖啡的有趣谜题",
  schema: schema
)
```

## 工具调用：扩展模型能力

通过Tool协议，模型可以执行自定义操作：

```swift
struct FindContactTool: Tool {
  let name = "findContact"
  let description = "从指定年龄段查找联系人"
    
  @Generable
  struct Arguments {
    let generation: Generation
        
    enum Generation {
      case babyBoomers
      case genX
      case millennial
      case genZ            
    }
  }
  
  func call(arguments: Arguments) async throws -> ToolOutput {
    // 实现具体功能
    return ToolOutput(contact.givenName)
  }
}
```

### 工具调用流程
1. 注册工具实例
2. 模型自动分析需求并生成参数
3. 执行工具函数
4. 将结果整合到响应中

## 最佳实践建议
1. **上下文管理**：合理处理会话长度，避免超出限制
2. **错误处理**：准备好应对语言不支持等特殊情况
3. **隐私保护**：利用设备端处理的优势保护用户数据

## 相关视频

[了解 Foundation Models 框架](https://developer.apple.com/videos/play/wwdc2025/286)
[探索 Apple 平台上的机器学习和 AI 框架](https://developer.apple.com/videos/play/wwdc2025/360)
[跟着视频学编程：使用 Foundation Models 框架将设备端 AI 引入你的 App](https://developer.apple.com/videos/play/wwdc2025/259)

## 文档资源

[人机界面指南：生成式AI](https://developer.apple.com/design/human-interface-guidelines/generative-ai)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)
---
title: 探索 visionOS 上的空间配件输入
date: 2025-06-10 15:36:49
categories:
- wwdc2025
tags:
- wwdc2025
- visionos
- 图形和游戏
---
了解如何将空间配件整合到你的 app 中。展示虚拟内容、与 app 进行交互、在空间中进行追踪，并获取有关交互效果的信息，进一步提升 visionos 上的虚拟体验。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/10011/10011_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/289/)

# 在 visionOS 中集成空间配件：开发实践与设计指南

## 引言

随着 Apple Vision Pro 的推出，空间计算体验迎来了新的可能性。今年 WWDC 带来的空间配件支持功能，让开发者能够通过 PlayStation VR2 Sense 控制器和罗技 Muse 手写笔等设备，为用户提供更精确的输入控制和沉浸式反馈体验。本文将深入解析如何在 visionOS 应用中整合这些空间配件，从技术实现到设计考量，一网打尽。

## 空间配件概述

visionOS 目前支持两类空间配件：

1. **PlayStation VR2 Sense 控制器**
   - 专为游戏场景设计
   - 配备按钮、摇杆和扳机键
   - 支持标准手势操作
   - 高精度空间追踪，适合运动类游戏

2. **罗技 Muse 手写笔**
   - 专为生产力与创意应用设计
   - 力敏传感器提供变量输入
   - 侧键与笔尖支持
   - 强大的触觉反馈功能

这些配件通过 Apple Vision Pro 的摄像头与其内置传感器协同工作，实现精确的空间位置和旋转追踪。

## 开发实践：构建空间雕刻应用

### 1. Xcode 基础配置

首先需要在项目中添加必要的配置：

```swift
// 在 capabilities 编辑器中添加 Spatial Gamepad 支持
// 并在 Info.plist 中添加：
// Accessory Tracking Usage 描述: "追踪配件移动以雕刻虚拟粘土"
```

该描述会显示为系统权限提示，告知用户配件追踪的目的。

### 2. 配件连接管理

监听配件连接事件是关键步骤：

```swift
// 检查空间配件支持
NotificationCenter.default.addObserver(forName: NSNotification.Name.GCControllerDidConnect, 
                                     object: nil, 
                                     queue: nil) { notification in
    if let controller = notification.object as? GCController,
       controller.productCategory == GCProductCategorySpatialController {
        // 处理控制器连接
    }
}

// 对于手写笔的特殊处理
NotificationCenter.default.addObserver(forName: NSNotification.Name.GCStylusDidConnect, 
                                     object: nil, 
                                     queue: nil) { notification in
    if let stylus = notification.object as? GCStylus,
       stylus.productCategory == GCProductCategorySpatialStylus {
        // 处理手写笔连接
    }
}
```

### 3. 虚拟内容锚定

使用 RealityKit 的锚点系统将虚拟内容与配件位置同步：

```swift
func setupSpatialAccessory(device: GCDevice) async throws {
    let source = try await AnchoringComponent.AccessoryAnchoringSource(device: device)
    guard let location = source.locationName(named: "aim") else { return }
    let sculptingEntity = AnchorEntity(.accessory(from: source, location: location), 
                                     trackingMode: .predicted)
    // 添加虚拟模型到 sculptingEntity
}
```

追踪模式说明：
- `.predicted`: 低延迟渲染，适合快速响应需求
- `.continuous`: 更高精度，适合精细操作

### 4. 触觉反馈实现

增强交互真实感的触觉反馈实现：

```swift
let stylus: GCStylus = ...
guard let haptics = stylus.haptics else { return }
guard let hapticsEngine: CHHapticEngine = haptics.createEngine(withLocality: .default) else { return }
do {
    try hapticsEngine.start()
    // 在适当时机触发反馈
    let pattern = try CHHapticPattern(events: [...], parameters: [...])
    let player = try hapticsEngine.makePlayer(with: pattern)
    try player.start(atTime: 0)
} catch {
    print("触觉反馈错误: \(error)")
}
```

## ARKit直接追踪方案

对于需要更底层控制的场景，可以直接使用ARKit API：

1. 配置AccessoryTrackingProvider
2. 处理配件连接/断开事件
3. 选择适当的更新模式：
   - 实时流式更新
   - 按需预测更新

示例项目《Tracking accessories in volumetric windows》展示了完整实现。

## 重要设计考量

### 1. 输入兼容性

确保应用同时支持手势和控制器输入：

```swift
ContentView()
    .receivesEventsInView(true)  // 允许视图接收控制器输入
```

空间事件手势会自动获取控制器的左右手信息，实现无缝切换。

### 2. 沉浸式体验优化

针对全空间应用的建议：
```swift
// 隐藏Home指示器
.persistentSystemOverlays(.hidden)

// 隐藏上肢和配件模型
.upperLimbVisibility(.hidden)
```

### 3. 适配策略

- 同时支持配件和手部输入
- 在App Store中添加适当徽章：
  - "支持空间游戏控制器"
  - 如需必备配件则使用"需要空间游戏控制器"

## 结语

空间配件为visionOS应用带来了新的交互维度，从游戏到创意工具都有广阔的应用前景。通过GameController、RealityKit和ARKit的协同工作，开发者可以实现精细控制与沉浸式反馈的完美结合。期待看到更多充分利用这些特性的创新应用！

## 相关视频

- [RealityKit 的新功能](https://developer.apple.com/videos/play/wwdc2025/287)
- [使用 ARKit 打造更出色的空间计算体验](https://developer.apple.com/videos/play/wwdc2024/10100)
- [使用 RealityKit 构建空间绘画 App](https://developer.apple.com/videos/play/wwdc2024/10104)
- [利用虚拟和物理游戏手柄](https://developer.apple.com/videos/play/wwdc2021/10081)
- [游戏控制器的进展](https://developer.apple.com/videos/play/wwdc2020/10614)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)
---
title: 用于打造沉浸式 App 的 Metal 渲染的新功能
date: 2025-06-10 15:37:14
categories:
- wwdc2025
tags:
- wwdc2025
- macos
- visionos
- 图形和游戏
---
探索用于通过 compositor services 打造沉浸式 app 的 metal 渲染的最新改进。了解如何通过添加悬停效果来突出展示 app 的交互式元素，以及如何通过动态渲染质量实现更高保真度的渲染。了解新的 progressive 沉浸样式。探索如何通过将 mac 中的 metal 内容直接渲染至 vision pro，来为 macos app 提供沉浸式体验。

要充分利用好本次讲座，请先观看 wwdc23 讲座“探索 metal 技术打造沉浸式 app”。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9895/9895_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/294/)

# 探索 Vision Pro 的 Metal 渲染新功能：打造更沉浸的体验

## 引言
随着 Vision Pro 的推出，开发者们获得了在 visionOS 上创建沉浸式应用的新机遇。苹果在今年的开发者大会上宣布了一系列 Metal 渲染的新功能，这些改进将为用户带来更丰富、更交互的沉浸式体验。本文将详细介绍这些新特性，帮助开发者更好地利用它们。

## 新的渲染循环 API
Metal 沉浸式应用始于 SwiftUI，开发者需要创建包含 compositor 层的沉浸空间。今年的 Compositor Services 新增了返回数组的 `queryDrawables` 函数：

```swift
// 场景渲染循环示例
extension Renderer {
    func renderFrame(with scene: MyScene) {
        guard let frame = layerRenderer.queryNextFrame() else { return }
        
        frame.startUpdate()
        scene.performFrameIndependentUpdates()
        frame.endUpdate()

        let drawables = frame.queryDrawables()
        guard !drawables.isEmpty else { return }

        guard let timing = frame.predictTiming() else { return }
        LayerRenderer.Clock().wait(until: timing.optimalInputTime)
        frame.startSubmission()
        scene.render(to: drawable)
        frame.endSubmission()
    }
}
```

根据系统上下文，该数组可能包含 1-2 个 drawable，这为开发提供了更大的灵活性。

## 交互式悬停效果
新增的悬停效果能让用户直观识别可交互对象。实现步骤包括：
1. 配置 layer renderer 使用 8 位像素格式的跟踪区域纹理
2. 注册交互对象时添加唯一标识符
3. 通过 .automatic 属性添加悬停效果

使用多采样抗锯齿(MSAA)时需要特别注意跟踪区域纹理的处理方式。

## 动态渲染质量
开发者现在可以根据场景复杂度动态调整分辨率：
1. 指定应用适用的最大渲染质量
2. 运行时在设定范围内调整质量等级

质量调整会影响纹理细节和性能，开发者应针对不同场景元素采用合适的质量设置。

## 渐进式沉浸模式
新型渐进式沉浸模式允许用户通过 Digital Crown 控制沉浸度：
1. 仅支持 layered 布局
2. 配置 8 位模板格式(stencil8)
3. 添加 render context 绘制模板遮罩

Xcode 模板已经包含渐进式沉浸的完整示例，开发者可以直接参考。

## macOS 空间渲染
最新功能允许通过 Mac 向 Vision Pro 直接渲染/流式传输沉浸式内容：
1. 使用 RemoteImmersiveSpace 场景类型
2. 通过 remoteDeviceIdentifier 连接 ARKit 会话
3. 支持多种输入方式

C/C++渲染引擎可以通过原生 C API 接入，为已有应用添加沉浸式功能提供了便利。

## 结论
这些 Metal 渲染新功能为开发者提供了更强大的工具，可以创建更具交互性、更沉浸的应用体验。无论是悬停效果、动态质量调整还是渐进式沉浸模式，都为应用带来了新的可能性。特别是 Mac 内容直接渲染至 Vision Pro 的能力，为高性能应用开发开辟了新途径。

## 相关视频
- [探索 visionOS 上的空间配件输入](https://developer.apple.com/videos/play/wwdc2025/289)
- [visionOS 26 的新功能](https://developer.apple.com/videos/play/wwdc2025/317)
- [在 visionOS 中使用透视功能渲染 Metal](https://developer.apple.com/videos/play/wwdc2024/10092)
- [探索 Metal 技术打造沉浸式 App](https://developer.apple.com/videos/play/wwdc2023/10089)

## 文档
- [Optimizing GPU performance](https://developer.apple.com/documentation/Xcode/Optimizing-GPU-performance)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)
---
title: 跟着视频学编程：使用 Foundation Models 框架将设备端 AI 引入你的 App
date: 2025-06-10 15:44:49
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- macos
- 机器学习与-ai
---
使用 foundation models 框架为你的 swiftui app 开发生成式 ai 功能。首先，应用这个框架的基本要素来创建一个出色的功能。然后，观看一些分步示例以了解如何使用你构建的工具来完善模型、流式传输结果，并进行进一步优化以提升性能。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9966/9966_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/259/)

# 在 SwiftUI 应用中集成设备端 AI：Foundation Models 框架实践指南

## 引言
在当今移动应用开发中，集成人工智能功能已成为提升用户体验的重要方式。Apple 推出的 Foundation Models 框架为开发者提供了直接在设备端运行大型语言模型的能力，既保证了用户数据隐私，又无需增加应用体积。本文将带你从零开始，在 SwiftUI 应用中实现一个智能旅行规划功能，涵盖从基础实现到高级优化的完整流程。

## 核心概念：Foundation Models 框架
Foundation Models 框架允许开发者调用 Apple 设备端预置的大型语言模型，具有以下显著优势：
- **隐私保护**：所有计算在设备端完成，用户数据永不离开设备
- **离线运行**：模型已内置在操作系统中，无需网络连接
- **跨平台支持**：兼容 macOS、iPadOS、iOS 和 visionOS
- **轻量化**：不会增加应用安装包体积

## 开发实战：打造智能旅行规划应用

### 1. 提示词工程优化
```swift
// 初始简单提示
let prompt = "创建行程"

// 优化后的结构化提示
let optimizedPrompt = """
为坐标(34.01,-116.16)附近的约书亚树国家公园创建3天行程，
包含每日活动和推荐景点，格式需匹配Itinerary结构体
"""
```

**关键技巧**：
- 使用 Xcode Playground 实时调试提示词
- 提供明确的位置信息和格式要求
- 通过 `@Generable` 标注数据结构，让模型生成结构化响应

### 2. 工具调用集成
```swift
struct LandmarkTool: FoundationModels.Tool {
    let name = "landmark_search"
    let description = "搜索指定坐标附近的景点"
    
    func call(_ input: LandmarkRequest) async throws -> LandmarkResponse {
        // 使用MapKit实现具体搜索逻辑
        let landmarks = MKLocalSearch(...).start()
        return LandmarkResponse(results: landmarks)
    }
}
```

**实现要点**：
- 定义符合 `Tool` 协议的工具类型
- 提供清晰的名称和自然语言描述
- 确保输入输出类型都标记为 `@Generable`

### 3. 流式输出实现
```swift
// 改造响应处理为流式
for await partialResult in try await session.respond(to: prompt) {
    // 处理部分生成的PartiallyGenerated结构体
    if let title = partialResult.title {
        itineraryView.updateTitle(title)
    }
    if let days = partialResult.days {
        itineraryView.updateDays(days)
    }
}
```

**用户体验优化**：
- 逐步显示生成结果，减少等待感
- 配合动画效果提升流畅度
- 优先显示关键信息（如标题）

## 性能调优实战

### 1. 预加载策略
```swift
// 用户点击地标时预加载模型
Button(action: {
    Task {
        // 提前加载模型
        try await ModelLoader.shared.prepare(model: .itineraryPlanner)
        // 同时让用户阅读地标描述
    }
}) { ... }
```

### 2. 架构传输优化
```swift
let options = GenerationOptions(
    includeSchemaInPrompt: false, // 禁用重复的结构描述
    tools: [LandmarkTool()]
)
```

**优化效果**：
- 输入令牌数减少40%
- 总响应时间缩短35%
- 首次请求延迟降低60%

## 异常处理与兼容性
```swift
// 检查设备支持状态
switch FoundationModelsAvailability.current {
case .supportedAndEnabled:
    // 显示生成按钮
case .supportedButNotEnabled:
    // 提示用户启用
case .notSupported:
    // 隐藏相关功能
}
```

**注意事项**：
- 使用 Xcode 方案设置测试不同可用性场景
- 提供优雅降级方案
- 明确告知用户功能限制

## 结语
通过 Foundation Models 框架，我们成功构建了一个隐私安全、高效智能的旅行规划应用。设备端 AI 为应用开发开辟了新的可能性，既保障了用户隐私，又提供了实时响应能力。建议开发者深入研究相关文档和视频资源，掌握更多高级功能。

## 相关视频
- [了解 Foundation Models 框架](https://developer.apple.com/videos/play/wwdc2025/286)
- [探索 Apple 平台上的机器学习和 AI 框架](https://developer.apple.com/videos/play/wwdc2025/360)
- [探索设备端基础模型的提示设计和安全](https://developer.apple.com/videos/play/wwdc2025/248)
- [深入了解 Foundation Models 框架](https://developer.apple.com/videos/play/wwdc2025/301)

## 文档
- [使用 Foundation Models 生成内容和执行任务](https://developer.apple.com/documentation/FoundationModels/generating-content-and-performing-tasks-with-foundation-models)
- [人机界面指南：生成式 AI](https://developer.apple.com/design/human-interface-guidelines/generative-ai)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)
---
title: 异步动画方案探讨
date: 2017-11-19 21:02:
categories:
- iOS
tags:
- 动画
---

大家在平时开发动画的过程中不知道是否有碰到CAAnimation被打断的时候。目前App的交互越来越复杂，动画的使用场景也越来越多，很多时候都有很复杂的动画，所以目前有几个比较有名的动画开源库lottie和Keyframes，但都是基于CAAnimation的，也就是说，layout之后会阻断动画播放。

## 

所有UI组件都必须在主线程调用，那么视图更新也只能在主线程吗？显然不是，在使用视频播放功能时，当我们在主线程断点时，会发现视频在继续播放，这就说明了视频的更新肯定不在主线程。那么怎么样才能让视图更新发生在子线程呢？目前可以做到这一点的就是OpenGL。

作为一种异步更新的方案，这比异步渲染成图片的方式更加完全的“异步”，同时也节省了很多CPU与GPU之间的内存拷贝操作，也提升了性能。

相比于Core Animation，OpenGL的绘制不会被layout打断，因为两者会处于一个不同的维度之间。

但是缺点也比较明显，利用OpenGL的方式去渲染，也就相当于像游戏那样去渲染动画，不能利用目前的视图结构树。对比与lottie的layer动画，OpenGL需要自己去处理类似的图层与时间函数。

与上一篇利用视频来做动画，OpenGL的好处是能够按照不同尺寸都生成清晰的动画，同时也可以减少应用程序包大小，而且保留了alpha通道信息。

##

这是一个比较激进的想法，按我的理解来说，目前设备的性能一般都已经很好了，同时一般应用都会以业务为优先，使用流畅没有卡顿就已经足够，并不需要太过于花哨的动效。所以应该都不会需要这种方案。如果真的在一些场景下需要如此，那么我觉得使用CAAnimation可能已经不能满足目前的需求了，可以考虑使用SpiritKit等游戏框架方案。

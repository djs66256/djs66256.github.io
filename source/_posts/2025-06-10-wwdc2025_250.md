---
title: å°†ç»“æ„åŒ–å¹¶å‘ä»£ç ä¸ Network æ¡†æ¶æ­é…ä½¿ç”¨
date: 2025-06-10 21:46:48
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- macos
- tvos
- visionos
- watchos
- ç³»ç»ŸæœåŠ¡
---
network æ¡†æ¶æ˜¯åœ¨ apple å¹³å°ä¸Šå»ºç«‹åº•å±‚ç½‘ç»œè¿æ¥çš„æœ€ä½³æ–¹å¼ï¼Œè€Œåœ¨ iosã€ipadosã€å’Œ macos 26 ä¸Šï¼Œå®ƒéå¸¸é€‚åˆä¸ä½ çš„ç»“æ„åŒ–å¹¶å‘ä»£ç æ­é…ä½¿ç”¨ã€‚æˆ‘ä»¬å°†æ¢ç´¢å¦‚ä½•å»ºç«‹è¿æ¥ã€å‘é€å’Œæ¥æ”¶æ•°æ®ä¸åˆ†å¸§å¤„ç†çš„ä¿¡æ¯ã€ç›‘å¬ä¼ å…¥è¿æ¥ä»¥åŠæµè§ˆç½‘ç»œä¸Šçš„æœåŠ¡ã€‚åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬è¿˜å°†ä»‹ç»ä¸€äº›å…³é”®çš„æœ€ä½³åšæ³•ã€‚
<!--more-->

![è§†é¢‘å°é¢](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9923/9923_wide_250x141_2x.jpg)
[è§†é¢‘åœ°å€](https://developer.apple.com/cn/videos/play/wwdc2025/250/)
> æ­¤æ–‡ç« ç”±AIç”Ÿæˆï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»[djs66256@163.com](djs66256@163.com)

# æ¢ç´¢ Network æ¡†æ¶ä¸­çš„ç»“æ„åŒ–å¹¶å‘ç¼–ç¨‹

Network æ¡†æ¶ä½œä¸º Apple å¹³å°åº•å±‚ç½‘ç»œè¿æ¥çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼Œåœ¨ iOSã€iPadOS å’Œ macOS 26 ç³»ç»Ÿä¸­è¿æ¥äº†é‡å¤§é©æ–°ã€‚è¯¥æ¡†æ¶ç°å·²æ·±åº¦æ•´åˆ Swift çš„ç»“æ„åŒ–å¹¶å‘ç‰¹æ€§ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´åŠ ç°ä»£åŒ–ã€ç®€æ´é«˜æ•ˆçš„ç½‘ç»œç¼–ç¨‹ä½“éªŒã€‚

## ç°ä»£åŒ–ç½‘ç»œè¿æ¥çš„æ„å»º

Network æ¡†æ¶å½»åº•æ‘’å¼ƒäº†ä¼ ç»Ÿ socket ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œæ— éœ€å¼€å‘è€…å¤„ç† sockaddr ç»“æ„ä½“æˆ–æ™¦æ¶©çš„ ioctl è°ƒç”¨ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä¼˜é›…çš„å£°æ˜å¼ API è®¾è®¡å’Œè‡ªåŠ¨åŒ–çš„ç½‘ç»œç®¡ç†åŠŸèƒ½ã€‚

æ¡†æ¶å†…ç½®çš„å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š
- è‡ªåŠ¨åŸŸåè§£æçš„"æŒ‰åè¿æ¥"(Connect by Name)åŠŸèƒ½
- åŠ¨æ€é€‰æ‹©æœ€ä¼˜è·¯å¾„çš„"å¿«ä¹çœ¼ç "(Happy Eyeballs)ç®—æ³•
- åŸç”Ÿçš„ TLS åŠ å¯†æ”¯æŒ
- æ™ºèƒ½ç½‘ç»œæ¥å£åˆ‡æ¢å’Œä»£ç†æ”¯æŒ
- ç°ä»£ä¼ è¾“åè®®å¦‚ QUIC çš„åŸç”Ÿé›†æˆ

è¿™äº›ç‰¹æ€§ä½¿å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…æ“å¿ƒåº•å±‚ç½‘ç»œç»†èŠ‚ã€‚

## å£°æ˜å¼è¿æ¥å»ºç«‹

åœ¨ iOS/macOS 26 ä¸­ï¼Œå»ºç«‹ç½‘ç»œè¿æ¥å˜å¾—å‰æ‰€æœªæœ‰çš„ç®€å•ã€‚å¼€å‘è€…åªéœ€æŒ‡å®šä¸‰ä¸ªæ ¸å¿ƒè¦ç´ ï¼š
1. ç«¯ç‚¹(Endpoint) - å®šä¹‰è¿æ¥ç›®æ ‡
2. åè®®æ ˆ(Protocol Stack) - è§„å®šè¿æ¥æ–¹å¼
3. å‚æ•°(Parameters) - ç»†åŒ–è¿æ¥é…ç½®

ä¸€ä¸ªå…¸å‹çš„ TLS åŠ å¯†è¿æ¥ç¤ºä¾‹ï¼š

```swift
let connection = NetworkConnection(to: .hostPort(host: "www.example.com", port: 1029)) {
  TLS()
}
```

æ¡†æ¶ä¼šè‡ªåŠ¨æ¨æ–­å¹¶æ·»åŠ å¿…è¦çš„ TCP å’Œ IP åè®®å±‚ã€‚å¦‚éœ€è¿›ä¸€æ­¥è‡ªå®šä¹‰ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨åµŒå¥—å¼çš„å£°æ˜è¯­æ³•ï¼š

```swift
let connection = NetworkConnection(to: .hostPort(host: "www.example.com", port: 1029) {
  TLS {
    TCP {
      IP()
        .fragmentationEnabled(false)
    }
  }
}
```

## æ™ºèƒ½åŒ–æ•°æ®ä¼ è¾“

Network æ¡†æ¶çš„æ•°æ®æ”¶å‘æ“ä½œå®Œå…¨é‡‡ç”¨å¼‚æ­¥è®¾è®¡ï¼Œä¸ Swift çš„ç»“æ„åŒ–å¹¶å‘å®Œç¾èåˆã€‚åŸºæœ¬çš„æ•°æ®æ”¶å‘æ“ä½œç®€æ´æ˜äº†ï¼š

```swift
let outgoingData = Data("Hello, world!".utf8)
try await connection.send(outgoingData)

let incomingData = try await connection.receive(exactly: 98).content
```

å¯¹äºä¸ç¡®å®šé•¿åº¦çš„æ•°æ®æµï¼Œæ¡†æ¶æä¾›äº†çµæ´»çš„æ¥æ”¶æ¨¡å¼ï¼š

```swift
while remaining > 0 {
    let imageChunk = try await connection.receive(atLeast: 1, atMost: remaining).content
    remaining -= imageChunk.count
}
```

## æ¶ˆæ¯åˆ†å¸§ä¸å¯¹è±¡ä¼ è¾“

ä¸ºè§£å†³æµå¼åè®®çš„æ¶ˆæ¯è¾¹ç•Œé—®é¢˜ï¼ŒiOS/macOS 26 å¼•å…¥äº† TLV (Type-Length-Value) åˆ†å¸§å™¨ï¼š

```swift
enum GameMessage: Int {
  case selectedCharacter = 0
  case move = 1
}

let connection = NetworkConnection(to: .hostPort(host: "www.example.com", port: 1029)) {
    TLV { TLS() }
}
try await connection.send(characterData, type: GameMessage.selectedCharacter.rawValue)
```

æ›´ä»¤äººæƒŠå–œçš„æ˜¯å¯¹ Swift Codable çš„åŸç”Ÿæ”¯æŒï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥æ”¶å‘å¯¹è±¡ï¼š

```swift
enum GameMessage: Codable {
  case selectedCharacter(String)
  case move(row: Int, column: Int)
}

let connection = NetworkConnection(to: .hostPort(host: "www.example.com", port: 1029)) {
    Coder(GameMessage.self, using: .json) { TLS() }
}
try await connection.send(GameMessage.selectedCharacter("ğŸ¨"))
let message = try await connection.receive().content
```

## æœåŠ¡ç›‘å¬ä¸è®¾å¤‡å‘ç°

å¤„ç†å…¥ç«™è¿æ¥çš„ NetworkListener é‡‡ç”¨äº†ä¸ NetworkConnection ç±»ä¼¼çš„è®¾è®¡æ¨¡å¼ï¼š

```swift
try await NetworkListener {
    Coder(GameMessage.self, using: .json) { TLS() }
}.run { connection in
    for try await (gameMessage, _) in connection.messages {
        // å¤„ç†æ¸¸æˆæ¶ˆæ¯
    }
}
```

è®¾å¤‡å‘ç°æ–¹é¢ï¼Œæ–°çš„ NetworkBrowser æ•´åˆäº† Wi-Fi Aware æŠ€æœ¯ï¼Œæ”¯æŒè·¨å¹³å°ç‚¹å¯¹ç‚¹å‘ç°ï¼š

```swift
let endpoint = try await NetworkBrowser(for: .wifiAware(.connecting(to: .allPairedDevices, from: .ticTacToeService))).run { endpoints in
    .finish(endpoints.first!)
}
```

## åè®®é€‰æ‹©æŒ‡å—

å¼€å‘è€…å¯æ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©åˆé€‚çš„åè®®ç»„åˆï¼š
- ä¸ç¬¬ä¸‰æ–¹æœåŠ¡é€šä¿¡ï¼šéµå¾ªå¯¹æ–¹åè®®è§„èŒƒ
- è‡ªä¸»åº”ç”¨é—´é€šä¿¡ï¼šæ¨è Codable + TLS/QUIC
- ç°æœ‰ URLSession ç”¨æˆ·ï¼šå¯ç»§ç»­ä½¿ç”¨ç°æœ‰æ–¹æ¡ˆ

## æ€»ç»“

iOS/macOS 26 ä¸º Network æ¡†æ¶å¸¦æ¥çš„é©æ–°åŒ…æ‹¬ï¼š
- ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼šNetworkConnectionã€NetworkListenerã€NetworkBrowser
- æ–°å‹æ¶ˆæ¯åˆ†å¸§å™¨å’Œå¯¹è±¡ä¼ è¾“æ”¯æŒ
- å£°æ˜å¼ API è®¾è®¡è¯­è¨€
- æ·±åº¦ç»“æ„åŒ–å¹¶å‘é›†æˆ

è¿™äº›æ”¹è¿›ä½¿ç½‘ç»œç¼–ç¨‹æ›´åŠ ç°ä»£åŒ–ã€é«˜æ•ˆï¼ŒåŒæ—¶ä¿æŒäº†æ¡†æ¶åŸæœ‰çš„çµæ´»æ€§å’Œå¼ºå¤§åŠŸèƒ½ã€‚å¼€å‘è€…ç°åœ¨å¯ä»¥æ›´è½»æ¾åœ°æ„å»ºå¯é ã€å®‰å…¨çš„ç½‘ç»œåº”ç”¨ï¼Œå……åˆ†å‘æŒ¥ Swift å¹¶å‘çš„ä¼˜åŠ¿ã€‚

## ç›¸å…³è§†é¢‘

[å€ŸåŠ© Wi-Fi Aware å¢å¼ºè®¾å¤‡è¿æ¥æ€§èƒ½](https://developer.apple.com/videos/play/wwdc2025/228)  
[é‡‡ç”¨ Swift å¹¶å‘](https://developer.apple.com/videos/play/wwdc2025/268)  
[Introducing Network.framework: A modern alternative to Sockets](https://developer.apple.com/videos/play/wwdc2018/715)

## æ–‡æ¡£èµ„æº

[Network](https://developer.apple.com/documentation/Network)  
[NetworkBrowser](https://developer.apple.com/documentation/Network/NetworkBrowser)  
[NetworkConnection](https://developer.apple.com/documentation/Network/NetworkConnection)  
[NetworkListener](https://developer.apple.com/documentation/Network/NetworkListener)

---
title: 使用 EnergyKit 优化家庭用电量
date: 2025-06-10 15:48:03
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- 系统服务
---
了解如何在你的 app 中支持 energykit，以便用户可以优化家庭用电量。这可以帮助用户在电力更清洁、更便宜的时段运行电器或为电动汽车充电。详细了解如何进行设置，如何生成充电计划，以及如何通过用电量反馈向用户提供能耗洞察信息等详情。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9902/9902_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/257/)

# 使用 EnergyKit 优化家庭用电量

## 简介
EnergyKit 是一个全新的开发框架，旨在帮助住宅类应用开发者整合电网洞察功能，让用户能够在电力更清洁、更便宜的时段运行电器或为电动汽车充电。通过本文，你将了解如何设置 EnergyKit、生成充电计划，以及如何利用用电量反馈为用户提供有价值的能耗洞察。

## 启用 EnergyKit
要使用 EnergyKit，用户需要先选择加入清洁能源充电计划，并为每个充电位置进行设置。在我们的示例中，充电位置列表代表电动汽车的不同充电地点。

### 关键步骤
1. 添加开关选项让用户可以启用清洁能源充电
2. EnergyVenue 代表设备从电网取电的物理场所
3. 用户需要通过家庭应用或 EnergyKit 启用流程建立"家"
4. 保存场所与充电位置的映射关系

```swift
// Retrieve an EnergyVenue
import EnergyKit
import Foundation

@Observable final class EnergyVenueManager  {
    let venue: EnergyVenue

    init?(venueID: UUID) async {
        guard let energyVenue = await EnergyVenue.venue(for: venueID) else {
            return nil
        }
        venue = energyVenue
    }
}
```

## 生成充电计划
确认用户启用清洁能源充电并选择 EnergyVenue 后，下一步是生成清洁能源充电计划。

### 用电指导类型
- **减少**：适用于智能恒温器等可降低用电量的设备
- **转移**：适用于电动汽车等可以调整用电时段但总用电量不变的设备

```swift
// Fetch ElectricityGuidance
import EnergyKit
import Foundation

@Observable final class EnergyVenueManager  {
    var guidance: ElectricityGuidance?

    fileprivate func streamGuidance(
        venueID: UUID,
        update: (_ guidance: ElectricityGuidance) -> Void
    ) async throws {
        let query = ElectricityGuidance.Query(suggestedAction: .shift)
        for try await currentGuidance in ElectricityGuidance.sharedService.guidance(
            using: query,
            at: venueID
        ) {
            update(currentGuidance)
          	break
        }
    }
}
```

## 洞察分析
EnergyKit 提供易用的用电信息格式，帮助开发者向用户展示：
- 车辆充电时段中使用清洁电力的比例
- 基于电价时段的用电分类（五类）

### 提交 LoadEvents 反馈
应在充电过程中定期创建事件：
1. 充电开始时记录初始状态
2. 充电期间每15分钟记录稳态充电
3. 遇到特殊事件时额外记录
4. 充电结束时提交最终状态

```swift
// Update charging measurements
import EnergyKit

@Observable class ElectricVehicleController {
    fileprivate func chargingMeasurement() -> ElectricVehicleLoadEvent.ElectricalMeasurement {
        let stateOfCharge = Int(configuration.state.stateOfCharge.rounded(.down))
        let power = Measurement<UnitPower>(
            value: configuration.properties.chargingPower * 1000000,
            unit: .milliwatts
        )
        let energy = Measurement<UnitEnergy>(
            value: configuration.state.cummulativeEnergy * 1000000,
            unit: .EnergyKit.milliwattHours
        )
        return ElectricVehicleLoadEvent.ElectricalMeasurement(
            stateOfCharge: stateOfCharge,
            direction: .imported,
            power: power,
            energy: energy
        )
    }
}
```

## 结论
通过 EnergyKit，开发者可以轻松为应用添加智能用电功能，帮助用户节省开支并减少碳排放。我们介绍了核心功能包括场所设置、充电计划生成和用电洞察分析。现在就开始使用 EnergyKit，为用户创造更智能、更环保的应用体验吧！

## 相关视频
- [完成后台任务](https://developer.apple.com/videos/play/wwdc2025/227)
- [探索 SwiftUI 中的并发机制](https://developer.apple.com/videos/play/wwdc2025/266)

## 文档
- [Apple 2030](https://www.apple.com/environment/)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)
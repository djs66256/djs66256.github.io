---
title: è·Ÿç€è§†é¢‘å­¦ç¼–ç¨‹ï¼šä½¿ç”¨ SwiftUI å’Œ AttributedString ç²¾å¿ƒæ‰“é€ å¯Œæ–‡æœ¬ä½“éªŒ
date: 2025-06-10 15:29:56
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- macos
- visionos
- swift
---
äº†è§£å¦‚ä½•ä½¿ç”¨ swiftui çš„ texteditor api å’Œ attributedstring æ„å»ºå¯Œæ–‡æœ¬ä½“éªŒã€‚æ¢ç´¢å¦‚ä½•å¯ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ã€æ„å»ºç”¨æ¥æ“æ§ç¼–è¾‘å™¨å†…å®¹çš„è‡ªå®šæ§ä»¶ï¼Œå¹¶å¯¹æä¾›çš„ä¼—å¤šæ ¼å¼é€‰é¡¹è¿›è¡Œè‡ªå®šã€‚äº†è§£ attributedstring çš„é«˜çº§åŠŸèƒ½ï¼Œä»¥ä¾¿ç²¾å¿ƒæ‰“é€ è¶…æ£’çš„æ–‡æœ¬ç¼–è¾‘ä½“éªŒã€‚
<!--more-->

![è§†é¢‘å°é¢](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9982/9982_wide_250x141_2x.jpg)
[è§†é¢‘åœ°å€](https://developer.apple.com/cn/videos/play/wwdc2025/280/)

# ä½¿ç”¨ SwiftUI å’Œ AttributedString æ‰“é€ å¯Œæ–‡æœ¬ç¼–è¾‘å™¨  

## å¼•è¨€  

åœ¨ç°ä»£åº”ç”¨å¼€å‘ä¸­ï¼Œå¯Œæ–‡æœ¬ç¼–è¾‘åŠŸèƒ½å·²æˆä¸ºæå‡ç”¨æˆ·ä½“éªŒçš„é‡è¦ç¯èŠ‚ã€‚SwiftUI ä¸ AttributedString çš„ç»“åˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ„å»ºå¼ºå¤§å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ç»ä½³å·¥å…·ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ©ç”¨è¿™äº›æŠ€æœ¯ï¼Œä»åŸºç¡€å®ç°åˆ°é«˜çº§å®šåˆ¶ï¼Œæ‰“é€ å®Œç¾çš„æ–‡æœ¬ç¼–è¾‘ä½“éªŒã€‚

## åŸºç¡€å®ç°ï¼šä»çº¯æ–‡æœ¬åˆ°å¯Œæ–‡æœ¬  

### çº¯æ–‡æœ¬ç¼–è¾‘å™¨  

```swift
import SwiftUI

struct RecipeEditor: View {
    @Binding var text: String

    var body: some View {
        TextEditor(text: $text)
    }
}
```

è¿™æ˜¯æœ€åŸºæœ¬çš„æ–‡æœ¬ç¼–è¾‘å™¨å®ç°ï¼Œä»…æ”¯æŒçº¯æ–‡æœ¬ç¼–è¾‘ã€‚

### å‡çº§ä¸ºå¯Œæ–‡æœ¬æ”¯æŒ  

```swift
struct RecipeEditor: View {
    @Binding var text: AttributedString

    var body: some View {
        TextEditor(text: $text)
    }
}
```

åªéœ€å°†Stringæ”¹ä¸ºAttributedStringï¼Œç¼–è¾‘å™¨ç«‹å³è·å¾—ä»¥ä¸‹èƒ½åŠ›ï¼š
- æ”¯æŒç²—ä½“/æ–œä½“ç­‰æ ¼å¼åˆ‡æ¢
- è°ƒæ•´å­—å·ã€æ’å…¥Genmojiè¡¨æƒ…
- å®Œç¾é€‚é…æ·±è‰²æ¨¡å¼å’ŒåŠ¨æ€ç±»å‹
- å…¼å®¹SwiftUIçš„Textæ˜¾ç¤º

## AttributedStringåŸºç¡€  

AttributedStringç”±å­—ç¬¦åºåˆ—å’Œå±æ€§åŒºé—´ç»„æˆã€‚ä¾‹å¦‚ï¼š

```swift
var text = AttributedString("Hello ğŸ‘‹ğŸ»! Who's ready to get ")
var cooking = AttributedString("cooking")
cooking.foregroundColor = .orange
text += cooking
text += AttributedString("?")
text.font = .largeTitle
```

AttributedStringæ˜¯å€¼ç±»å‹ï¼Œé‡‡ç”¨UTF-8ç¼–ç ï¼Œå¹¶ç¬¦åˆEquatableã€Hashableç­‰Swiftåè®®ã€‚

## æ„å»ºè‡ªå®šä¹‰æ§ä»¶  

### å¸¸è§é”™è¯¯ç¤ºä¾‹  

```swift
struct RecipeEditor: View {
    @Binding var text: AttributedString
    @State private var selection = AttributedTextSelection()

    var body: some View {
        TextEditor(text: $text, selection: $selection)
            .preference(key: NewIngredientPreferenceKey.self, value: newIngredientSuggestion)
    }

    private var newIngredientSuggestion: IngredientSuggestion {
        let name = text[selection.indices(in: text)] // ç¼–è¯‘é”™è¯¯
        return IngredientSuggestion(suggestedName: AttributedString())
    }
}
```

é—®é¢˜åœ¨äºselection.indicesè¿”å›çš„æ˜¯RangeSetè€Œéå•ä¸€Rangeï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒåŒå‘æ–‡æœ¬å¸ƒå±€ã€‚

### æ­£ç¡®å®ç°æ–¹å¼  

```swift
private var newIngredientSuggestion: IngredientSuggestion {
    let name = text[selection] // ç›´æ¥ä½¿ç”¨selection
    return IngredientSuggestion(suggestedName: AttributedString(name))
}
```

## è‡ªå®šä¹‰æ–‡æœ¬æ ¼å¼  

### å®šä¹‰ä¸“å±æ ¼å¼  

```swift
struct RecipeFormattingDefinition: AttributedTextFormattingDefinition {
    struct Scope: AttributeScope {
        let foregroundColor: AttributeScopes.SwiftUIAttributes.ForegroundColorAttribute
        let adaptiveImageGlyph: AttributeScopes.SwiftUIAttributes.AdaptiveImageGlyphAttribute
        let ingredient: IngredientAttribute
    }

    var body: some AttributedTextFormattingDefinition<Scope> {
        IngredientsAreGreen() // é…æ–™æ–‡æœ¬æ˜¾ç¤ºä¸ºç»¿è‰²
    }
}
```

### å®ç°æ ¼å¼çº¦æŸ  

```swift
struct IngredientsAreGreen: AttributedTextValueConstraint {
    func constrain(_ container: inout Attributes) {
        container.foregroundColor = container.ingredient != nil ? .green : nil
    }
}
```

### é«˜çº§å±æ€§æ§åˆ¶  

```swift
struct IngredientAttribute: CodableAttributedStringKey {
    static let inheritedByAddedText = false // æ–°å¢æ–‡æœ¬ä¸ç»§æ‰¿å±æ€§
    static let invalidationConditions: Set<AttributedString.AttributeInvalidationCondition>? = [.textChanged] // æ–‡æœ¬ä¿®æ”¹æ—¶ç§»é™¤å±æ€§
}
```

è¿™ç§è®¾ç½®ç¡®ä¿ï¼š
- åœ¨é…æ–™æ–‡æœ¬åè¾“å…¥æ—¶ï¼Œæ–°æ–‡æœ¬ä¸ä¼šå˜ç»¿
- åˆ é™¤é…æ–™å­—ç¬¦æ—¶ï¼Œæ•´ä¸ªå•è¯ç«‹å³æ¢å¤é»˜è®¤é¢œè‰²

## ç»“è®º  

SwiftUIä¸AttributedStringçš„ç»“åˆä¸ºå¯Œæ–‡æœ¬ç¼–è¾‘æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚ä»åŸºç¡€å®ç°åˆ°é«˜çº§å®šåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºå‡ºæ»¡è¶³å„ç§éœ€æ±‚çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚æ— è®ºæ˜¯ç®€å•çš„æ ¼å¼è°ƒæ•´ï¼Œè¿˜æ˜¯å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™å¥—æŠ€æœ¯æ ˆéƒ½èƒ½å®Œç¾åº”å¯¹ã€‚

## ç›¸å…³è§†é¢‘  
- [æå‡Appçš„å¤šè¯­è¨€ä½“éªŒ](https://developer.apple.com/videos/play/wwdc2025/222)  
- [å‘å·¦è¯­è¨€](https://developer.apple.com/videos/play/wwdc2022/10107)  
- [Foundationä¸­çš„æ–°åŠŸèƒ½](https://developer.apple.com/videos/play/wwdc2021/10109)  

## æ–‡æ¡£  
- [AttributedTextFormatting](https://developer.apple.com/documentation/SwiftUI/AttributedTextFormatting)  
- [AttributedTextSelection](https://developer.apple.com/documentation/SwiftUI/AttributedTextSelection)  
- [Character](https://developer.apple.com/documentation/Swift/Character)
> æ­¤æ–‡ç« ç”±AIç”Ÿæˆï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»[djs66256@163.com](djs66256@163.com)
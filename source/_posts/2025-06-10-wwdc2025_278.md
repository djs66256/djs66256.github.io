---
title: 小组件的新功能
date: 2025-06-10 15:32:49
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- macos
- visionos
- watchos
- swiftui-和-ui-框架
---
widgetkit 带来小组件、实时活动以及控制方面的众多更新，助你提升 app 性能。了解如何将小组件引入 visionos，如何利用 carplay 车载让小组件在驾驶途中也能顺畅使用，以及如何使用强调渲染模式优化小组件的视觉效果。此外，探索如何让相关小组件呈现在 watchos 的智能叠放中，以及如何使用推送通知确保小组件保持最新。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9952/9952_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/278/)

# WidgetKit 新特性全解析：打造跨平台智能小组件体验

## 引言
随着 iOS 17 和 visionOS 的推出，WidgetKit 迎来了重大更新。小组件不再只是简单的信息展示窗口，而是成为连接用户与应用的核心桥梁。本文将深入解析如何利用 WidgetKit 的新特性，为您的应用打造更智能、更沉浸的小组件体验。

## 视觉革新：强调渲染模式
iOS 17 引入了全新的"透明玻璃"风格小组件呈现方式。这种视觉体系的核心是**强调渲染模式**，它会自动将小组件内容转为白色调，并替换背景为符合主题的玻璃或着色效果。

### 优化技巧
对于包含复杂视觉元素的小组件，可以使用 `widgetAccentedRenderingMode` 修饰符精确控制呈现效果：

```swift
Image(entry.beverageImage)
    .resizable()
    .widgetAccentedRenderingMode(.desaturated)
    .aspectRatio(contentMode: .fill)
```

支持五种渲染模式：
- `nil`: 应用主色调
- `.accented`: 应用强调色
- `.desaturated`: 去饱和度处理
- `.accentedDesaturated`: 复合效果
- `.fullColor`: 原色显示

## visionOS 小组件开发
visionOS 26 首次支持小组件功能，具有以下特性：

```swift
struct CaffeineTrackerWidget: Widget {
    var body: some WidgetConfiguration {
        StaticConfiguration(
            kind: "BaristaWidget",
            provider: Provider()
        ) { entry in
            CaffeineTrackerWidgetView(entry: entry)
        }
        .configurationDisplayName("咖啡因追踪")
        .description("记录每日咖啡因摄入量的小组件")
        .supportedMountingStyles([.elevated])
        .widgetTexture(.paper)
        .supportedFamilies([.systemExtraLargePortrait])
    }
}
```

关键配置项：
- `supportedMountingStyles`: 悬浮或嵌入风格
- `widgetTexture`: 材质选择（玻璃/纸质）
- `systemExtraLargePortrait`: 新增特大尺寸

## 跨平台适配策略
各平台新增支持：
- **CarPlay**: 仪表盘小组件叠放
- **macOS Tahoe**: iPhone 实时活动镜像
- **watchOS 26**: 
  - 控制中心/操作按钮/智能叠放三位置控件
  - 相关性小组件(RelevanceConfiguration)

## 内容更新机制
三种更新方式确保信息实时性：
1. 定时重载(TimelineReloadPolicy)
2. 应用主动触发(WidgetCenter API)
3. 服务器推送(WidgetPushHandler)

```swift
struct CaffeineTrackerPushHandler: WidgetPushHandler {
    func pushTokenDidChange(_ pushInfo: WidgetPushInfo, widgets: [WidgetInfo]) {
        // 向服务器注册推送令牌
    }
}
```

推送请求格式：
```json
{
    "aps": {
        "content-changed": true
    }
}
```

## 结语
WidgetKit 的新特性为开发者提供了更丰富的工具集，让小组件能在更多场景中发挥价值。无论是视觉优化、跨平台适配还是实时更新，这些改进都将显著提升用户体验。建议开发者根据应用特性，选择最适合的新功能进行集成。

## 相关视频
- [针对 CarPlay 车载优化你的 App](https://developer.apple.com/videos/play/wwdc2025/216)
- [针对 visionOS 设计小组件](https://developer.apple.com/videos/play/wwdc2025/255)
- [watchOS 26 的新功能](https://developer.apple.com/videos/play/wwdc2025/334)
- [为 Apple Watch 设计实时活动](https://developer.apple.com/videos/play/wwdc2024/10098)

## 文档资源
- [提升智能叠放中的小组件可见性](https://developer.apple.com/documentation/WidgetKit/Widget-Suggestions-In-Smart-Stacks)
- [优化强调渲染模式和玻璃效果](https://developer.apple.com/documentation/WidgetKit/optimizing-your-widget-for-accented-rerendering-mode-and-liquid-glass)
- [通过推送通知更新小组件](https://developer.apple.com/documentation/WidgetKit/Updating-widgets-with-widgetkit-push-notifications)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)
---
title: 小组件的新功能
date: 2025-06-10 21:46:47
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- macos
- visionos
- watchos
- swiftui-和-ui-框架
---
widgetkit 带来小组件、实时活动以及控制方面的众多更新，助你提升 app 性能。了解如何将小组件引入 visionos，如何利用 carplay 车载让小组件在驾驶途中也能顺畅使用，以及如何使用强调渲染模式优化小组件的视觉效果。此外，探索如何让相关小组件呈现在 watchos 的智能叠放中，以及如何使用推送通知确保小组件保持最新。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9952/9952_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/278/)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)

# 小组件新特性全面解析：WidgetKit 的跨平台进化

## 引言

WidgetKit 作为苹果生态系统中的重要组件，在 WWDC 2024 上迎来了一系列令人振奋的更新。这些改进不仅增强了小组件的功能性，更将其应用场景扩展到了 visionOS、CarPlay 车载等新平台。系统体验团队工程师 Tanner Oakes 以咖啡因记录应用为例，详细展示了如何充分利用这些新特性提升用户体验。

## 一、传统平台的小组件视觉升级

在 iOS 26 和 macOS Tahoe 中，小组件迎来了全新的视觉呈现方式。用户可将主屏幕配置为透明玻璃效果来展示图标和小组件，并选择特定色调进行深度自定义。这种新呈现方式采用了强调渲染模式技术，该技术会先生成白色调内容，再移除背景替换为符合主题的玻璃或着色效果。

开发者在适配过程中需要注意，像咖啡因追踪这样显示最常饮用饮料的小组件，在强调模式下可能会出现图像辨认困难的问题。解决方案是观察 `.widgetRenderingMode` 并添加条件渲染逻辑，使用 `.widgetAccentedRenderingMode` 修饰符提供的五种图像处理选项（包括去饱和、强调色等）来优化显示效果。

```swift
// 强调渲染模式的优化实现示例
Image("coffee-cup")
    .widgetAccentedRenderingMode(.selectiveColor)
```

## 二、visionOS 的小组件革命

visionOS 26 的重大突破在于允许应用包含小组件，这标志着小组件正式进入空间计算领域。兼容 iPhone/iPad 的小组件可以自动移植到 visionOS，并支持交互和动画功能。用户可以将小组件添加到空间环境中，选择悬浮或嵌入式两种呈现方式。

开发者为 visionOS 适配小组件时，可通过 `.supportedMountingStyles` 和 `.widgetTexture` 修饰符配置悬挂样式和材质（如纸质纹理）。新引入的 `systemExtraLargePortrait` 系列完善了海报风格的视觉效果，而 `LevelOfDetail` API 则能根据观看距离自动调整内容密度，确保远距离观看时的可读性。

```swift
// visionOS 小组件配置示例
WidgetConfiguration()
    .supportedMountingStyles([.floating, .embedded])
    .widgetTexture(.paper)
```

## 三、CarPlay 车载与 watchOS 的新整合

CarPlay 车载现在支持显示小组件和实时活动，这对驾驶场景下的应用体验提升显著。小组件显示在仪表板左侧的堆叠中，采用 StandBy 样式以确保清晰度。实时活动默认显示灵动岛视图，但开发者可以通过配置 `.supplementalActivityFamilies` 和 `.activityFamily` 来优化显示效果。

watchOS 26 引入了关联性小组件（Relevance Widgets）这一创新概念，它们仅在相关内容出现时才会显示在智能堆叠中。通过 `RelevanceConfiguration` 和 `RelevanceEntriesProvider` 的实现，可以创建根据时间区间等条件动态显示的小组件。

```swift
// 关联性小组件配置示例
RelevanceConfiguration(
    provider: CoffeeDealsProvider(),
    placeholder: Text("No current offers")
)
```

## 四、全面的更新机制

为确保跨设备数据同步，WidgetKit 提供了三种互补的更新机制：
1. 定时重新加载：适合定期更新内容
2. App 主动触发：通过 `WidgetCenter` API 实现
3. 服务器推送通知：针对外部数据变更

实现推送通知需要创建符合 `WidgetPushHandler` 的类型，并在小组件配置中添加 `.pushHandler` 修饰符。值得注意的是，系统会对推送更新实施预算管理以保障性能，开发期间可使用 WidgetKit 开发者模式暂时忽略这一限制。

```swift
// 推送通知处理示例
struct CoffeeWidgetPushHandler: WidgetPushHandler {
    func handle(_ notification: UNNotification) async {
        // 处理推送内容
    }
}
```

## 结论与最佳实践

WidgetKit 的这些新特性为开发者提供了更广阔的创新空间和更丰富的交互可能性。从 visionOS 的空间体验到 CarPlay 的车载整合，从 watchOS 的智能堆叠到跨平台推送更新，每个改进都值得开发者深入研究。

建议开发者根据具体场景组合使用不同的更新机制：紧急通知采用用户通知，限时更新使用实时活动，保持最新状态则选择推送更新。同时，充分利用新的视觉渲染模式和平台特定特性，为用户创造更自然、更智能的小组件体验。

## 相关资源

建议观看以下视频深入了解：
- CarPlay 车载优化
- visionOS 小组件设计  
- watchOS 26 新功能
- 实时活动设计
- 系统级控制扩展
- 推送通知专题

文档资源包括：
- 智能堆叠可见性优化  
- 强调渲染模式指南  
- RelevanceKit 文档  
- 推送通知实现  
- visionOS 适配指南

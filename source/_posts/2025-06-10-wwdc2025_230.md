---
title: 使用 AlarmKit API 实现唤醒功能
date: 2025-06-10 15:27:32
categories:
- wwdc2025
tags:
- wwdc2025
- ios
- ipados
- app-服务
---
铃-铃-铃！从你食谱 app 中的倒计时器到你旅行规划 app 中的闹钟，ios 和 ipados 26 中的 alarmkit 框架可将计时器和闹钟引入到锁定屏幕、灵动岛等其他地方。了解如何使用 app intents 框架来创建和管理你 app 的闹钟，自定闹钟的实时活动，并提供自定提醒操作。为了充分从这个视频中获益，建议你先观看 wwdc23 讲座“了解 activitykit”。
<!--more-->

![视频封面](https://devimages-cdn.apple.com/wwdc-services/images/3055294D-836B-4513-B7B0-0BC5666246B0/9928/9928_wide_250x141_2x.jpg)
[视频地址](https://developer.apple.com/cn/videos/play/wwdc2025/230/)

# AlarmKit 框架详解：在 iOS 中创建智能闹钟功能

## 引言
随着 iOS 和 iPadOS 26 的推出，Apple 引入了全新的 AlarmKit 框架，让开发者能够在应用中实现高级闹钟功能。无论是烹饪应用的倒计时器，还是旅行应用的行程提醒，AlarmKit 都能将这些功能带到锁定屏幕、灵动岛等系统级界面。本文将详细介绍如何使用 AlarmKit 框架创建和管理应用闹钟。

## AlarmKit 框架概览

AlarmKit 允许应用创建两种类型的提醒：
- **固定时间闹钟**：基于特定日期和时间触发
- **倒计时闹钟**：基于预设时长触发

这些提醒具有以下特性：
- 突破静音模式和专注模式限制
- 显示自定义标题和应用名称
- 支持在待机模式和 Apple Watch 上显示
- 可通过 Live Activities 实现动态倒计时界面

## 授权配置

使用 AlarmKit 前，需要获取用户授权：

1. 在 Info.plist 中添加 `NSAlarmKitUsageDescription` 说明使用目的
2. 通过代码请求授权：

```swift
import AlarmKit

func requestAuthorization() {
    AlarmManager.requestAuthorization { granted in
        if granted {
            print("授权成功")
        } else {
            print("授权被拒绝")
        }
    }
}
```

## 创建闹钟

### 倒计时设置

```swift
// 设置预提醒和后续提醒间隔（单位：秒）
let countdownDuration = Alarm.CountdownDuration(
    preAlert: (10 * 60),  // 10分钟预提醒
    postAlert: (5 * 60)   // 5分钟后续提醒间隔
)
```

### 日程安排

**固定日期模式**（不受时区变化影响）：

```swift
let keynoteDate = DateComponents(
    calendar: .current,
    year: 2025, 
    month: 6, 
    day: 9, 
    hour: 9, 
    minute: 41
)
let scheduleFixed = Alarm.Schedule.fixed(keynoteDate)
```

**相对时间模式**（自动适应时区变化）：

```swift
let time = Alarm.Schedule.Relative.Time(hour: 7, minute: 0)
let recurrence = Alarm.Schedule.Relative.Recurrence.weekly([.monday, .wednesday, .friday])
let schedule = Alarm.Schedule.Relative(time: time, repeats: recurrence)
```

## 界面定制

### 提醒按钮设置

```swift
let stopButton = AlarmButton(
    text: "关闭",
    textColor: .white,
    systemImageName: "stop.circle"
)

let repeatButton = AlarmButton(
    text: "重复",
    textColor: .white,
    systemImageName: "repeat.circle"
)

let alertPresentation = AlarmPresentation.Alert(
    title: "食物烹饪完成!",
    stopButton: stopButton,
    secondaryButton: repeatButton,
    secondaryButtonBehavior: .countdown
)
```

### 实时活动界面

```swift
struct AlarmLiveActivity: Widget {
    var body: some WidgetConfiguration {
        ActivityConfiguration(for: AlarmAttributes<CookingData>.self) { context in
            switch context.state.mode {
                case .countdown: countdownView(context)
                case .paused: pausedView(context)
                case .alert: alertView(context)
            }
        }
    }
}
```

## 生命周期管理

使用 `AlarmManager` 管理闹钟状态：

```swift
// 创建闹钟
let alarm = Alarm(
    id: UUID(),
    schedule: schedule,
    presentation: alertPresentation,
    metadata: cookingData
)

// 调度闹钟
AlarmManager.shared.schedule(alarm)

// 取消闹钟
AlarmManager.shared.cancel(alarmID: alarm.id)
```

## 最佳实践

1. **适用场景选择**：
   - 精确倒计时（如烹饪、实验计时）
   - 循环提醒（如起床闹钟、服药提醒）

2. **界面设计原则**：
   - 保持提醒信息简洁明了
   - 倒计时界面应显示剩余时间
   - 提供明显的关闭和暂停/恢复按钮

3. **避免滥用**：
   - 不要替代关键系统通知
   - 不要用于时效性不强的普通提醒

## 结论

AlarmKit 为 iOS 应用带来了强大的闹钟功能，通过系统级集成提供了出色的用户体验。开发者可以灵活地定制闹钟的外观和行为，同时确保符合 Apple 的设计规范。

## 相关视频
- [了解 App Intents](https://developer.apple.com/videos/play/wwdc2025/244)
- [了解 ActivityKit](https://developer.apple.com/videos/play/wwdc2023/10184)

## 文档
- [ActivityKit 官方文档](https://developer.apple.com/documentation/ActivityKit)
- [AlarmKit 官方文档](https://developer.apple.com/documentation/AlarmKit)
- [App Intents 框架文档](https://developer.apple.com/documentation/AppIntents)
- [创建第一个 App Intent](https://developer.apple.com/documentation/AppIntents/Creating-your-first-app-intent)
- [实时活动人机界面指南](https://developer.apple.com/design/human-interface-guidelines/live-activities)
> 此文章由AI生成，可能存在错误，如有问题，请联系[djs66256@163.com](djs66256@163.com)